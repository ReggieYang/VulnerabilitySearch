package crawler;

import com.gargoylesoftware.htmlunit.WebClient;
import com.gargoylesoftware.htmlunit.html.HtmlAnchor;
import com.gargoylesoftware.htmlunit.html.HtmlPage;

import java.io.IOException;
import java.util.ArrayList;
import java.util.List;

public class Crawler {

    WebClient webClient;


    public void init() {
//        LogFactory.getFactory.setAttribute("org.apache.commons.logging.Log", "org.apache.commons.logging.impl.NoOpLog");
//        java.util.logging.Logger.getLogger("com.gargoylesoftware").setLevel(Level.OFF);
//        java.util.logging.Logger.getLogger("org.apache.commons.httpclient").setLevel(Level.OFF)
        webClient = new WebClient();
        webClient.getOptions().setCssEnabled(false);
        webClient.getOptions().setJavaScriptEnabled(false);
    }


    public void close() {
        webClient.close();
    }


    public List<String> getGoogleRes(String kw) {
        kw = kw.replaceAll(" ", "+");
        String url = String.format("https://www.google.com/search?q=%s&lr=lang_en", kw);
        try {
            System.out.println(url);
            HtmlPage page = webClient.getPage(url);
            System.out.println(page.getTextContent());

            List<String> list = new ArrayList<>();

            for (Object o : page.getByXPath("//div[@class='rc']//h3//a")) {
                System.out.println("haha");
                HtmlAnchor ha = (HtmlAnchor) o;
                list.add(ha.getHrefAttribute());
            }
            return list;

        } catch (IOException e) {
            e.printStackTrace();
        }
        return null;
    }


    public String crawlPage(String url) {
        try {
            HtmlPage page = webClient.getPage(url);
            if (page == null || page.getBody() == null || page.getBody().asText() == null) return null;
            else return page.getBody().asText().replaceAll("\\s+", " ");
        } catch (Exception e) {
            webClient.close();
            init();
            e.printStackTrace();
        }

        return null;

    }

}
